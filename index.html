<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Secure Quiz Management System</title>
    
    <!-- Firebase SDK -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/firebase/9.22.1/firebase-app-compat.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/firebase/9.22.1/firebase-firestore-compat.min.js"></script>
    
    <link rel="stylesheet" href="style.css">
</head>
<body>

    <!-- Login Page -->
    <div id="loginPage" class="page active">
        <div class="login-container">
            <div class="login-box">
                <h2 class="login-title">Student Login</h2>
                <div class="form-group">
                    <label for="rollNumber">Roll Number</label>
                    <input type="text" id="rollNumber" required placeholder="Enter your roll number">
                </div>
                <div class="form-group">
                    <label for="studentName">Full Name</label>
                    <input type="text" id="studentName" required placeholder="Enter your full name">
                </div>
                <div class="form-group">
                    <label for="studentClass">Class</label>
                    <select id="studentClass" required onchange="updateBatchOptions()">
                        <option value="">Select Class</option>
                        <option value="SE">SE (Second Year)</option>
                        <option value="TE">TE (Third Year)</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="studentBatch">Batch</label>
                    <select id="studentBatch" required>
                        <option value="">Select Batch</option>
                    </select>
                </div>
                <button class="btn btn-primary" id="studentLoginBtn" onclick="studentLogin()">Start Quiz</button>
                <div class="switch-link" onclick="showAdminLogin()">Admin Login</div>
                <div id="loginMessage"></div>
            </div>
        </div>
    </div>

    <!-- Admin Login Page -->
    <div id="adminLoginPage" class="page">
        <div class="login-container">
            <div class="admin-login-box">
                <h2 class="login-title">Admin Login</h2>
                <div class="form-group">
                    <label for="adminUsername">Username</label>
                    <input type="text" id="adminUsername" required placeholder="Enter admin username">
                </div>
                <div class="form-group">
                    <label for="adminPassword">Password</label>
                    <input type="password" id="adminPassword" required placeholder="Enter admin password">
                </div>
                <button class="btn btn-primary" id="adminLoginBtn" onclick="adminLogin()">Login</button>
                <div class="switch-link" onclick="showStudentLogin()">Student Login</div>
                <div id="adminLoginMessage"></div>
            </div>
        </div>
    </div>

    <!-- Fullscreen Prompt -->
    <div id="fullscreenPrompt" class="fullscreen-prompt">
        <div class="prompt-content">
            <h2>Secure Quiz Mode</h2>
            <p>This quiz requires fullscreen mode to prevent cheating. Click the button below to enter fullscreen and start the quiz.</p>
            <p><strong>Warning:</strong> Exiting fullscreen, switching tabs, or suspicious activities will be monitored and may result in automatic submission.</p>
            <button class="btn btn-primary" onclick="startSecureQuiz()">Enter Fullscreen & Start Quiz</button>
        </div>
    </div>

    <!-- Quiz Page -->
    <div id="quizPage" class="page">
        <div class="status-indicator" id="statusIndicator">🔒 Secure Mode</div>
        
        <div class="quiz-container">
            <div class="header">
                <h1 class="quiz-title">Technical Assessment Quiz</h1>
                <div class="quiz-info">
                    <div class="student-info" id="studentInfo">Student: Loading...</div>
                    <div class="timer" id="timer">Time: 30:00</div>
                    <div class="violation-counter" id="violationCounter">Violations: 0/3</div>
                </div>
            </div>

            <div class="question-card" id="questionCard">
                <div class="question-header">
                    <span class="question-number" id="questionNumber">Question 1 of 5</span>
                </div>
                <div class="question-text" id="questionText">Loading question...</div>
                <div class="options" id="optionsContainer">
                    <!-- Options will be loaded here -->
                </div>
                <div class="navigation">
                    <button class="btn-nav btn-secondary" id="prevBtn" onclick="previousQuestion()">Previous</button>
                    <button class="btn-nav btn-primary" id="nextBtn" onclick="nextQuestion()">Next</button>
                    <button class="btn-nav btn-primary" id="submitBtn" onclick="submitQuiz()" style="display: none;">Submit Quiz</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Admin Dashboard -->
    <div id="adminPage" class="page">
        <div class="container">
            <div class="admin-container">
                <div class="admin-header">
                    <h1 class="admin-title">Quiz Management Dashboard</h1>
                    <button class="logout-btn" onclick="logout()">Logout</button>
                </div>

                <div class="admin-tabs">
                    <div class="admin-tab active" onclick="showAdminTab('results')">Quiz Results</div>
                    <div class="admin-tab" onclick="showAdminTab('questions')">Question Management</div>
                </div>

                <!-- Quiz Results Tab -->
                <div id="resultsTab" class="admin-content active">
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-number" id="totalStudents">0</div>
                            <div class="stat-label">Total Students</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number" id="completedQuizzes">0</div>
                            <div class="stat-label">Completed Quizzes</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number" id="averageScore">0%</div>
                            <div class="stat-label">Average Score</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number" id="totalViolations">0</div>
                            <div class="stat-label">Total Violations</div>
                        </div>
                    </div>

                    <div class="filters">
                        <div class="filter-group">
                            <label>Class Filter</label>
                            <select id="classFilter" onchange="filterResults()">
                                <option value="">All Classes</option>
                                <option value="SE">SE</option>
                                <option value="TE">TE</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <label>Batch Filter</label>
                            <select id="batchFilter" onchange="filterResults()">
                                <option value="">All Batches</option>
                                <option value="S1">S1</option>
                                <option value="S2">S2</option>
                                <option value="S3">S3</option>
                                <option value="S4">S4</option>
                                <option value="T1">T1</option>
                                <option value="T2">T2</option>
                                <option value="T3">T3</option>
                                <option value="T4">T4</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <label>Status Filter</label>
                            <select id="statusFilter" onchange="filterResults()">
                                <option value="">All Status</option>
                                <option value="completed">Completed</option>
                                <option value="in-progress">In Progress</option>
                                <option value="violations">With Violations</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <label>Search Student</label>
                            <input type="text" id="searchStudent" onkeyup="filterResults()" placeholder="Search by name or roll no">
                        </div>
                        <div class="filter-group">
                            <button class="btn btn-secondary" onclick="exportResults()">Export Results</button>
                            <button class="btn btn-secondary" onclick="loadAdminDashboard()">Refresh Data</button>
                        </div>
                    </div>

                    <div class="results-table">
                        <div class="table-header">Quiz Results (Real-time)</div>
                        <div class="table-content">
                            <table>
                                <thead>
                                    <tr>
                                        <th>Roll No</th>
                                        <th>Name</th>
                                        <th>Class</th>
                                        <th>Batch</th>
                                        <th>Score</th>
                                        <th>Time Taken</th>
                                        <th>Violations</th>
                                        <th>Status</th>
                                        <th>Started At</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="resultsTableBody">
                                    <!-- Results will be populated here -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Question Management Tab -->
                <div id="questionsTab" class="admin-content">
                    <div class="question-form">
                        <h3 id="formTitle">Add New Question</h3>
                        <div class="form-group">
                            <label for="questionInput">Question</label>
                            <textarea id="questionInput" placeholder="Enter your question here..."></textarea>
                        </div>
                        <div class="options-container">
                            <div class="option-input">
                                <input type="radio" name="correctAnswer" value="0" id="correct0">
                                <input type="text" id="option0" placeholder="Option A">
                                <label for="correct0">Correct</label>
                            </div>
                            <div class="option-input">
                                <input type="radio" name="correctAnswer" value="1" id="correct1">
                                <input type="text" id="option1" placeholder="Option B">
                                <label for="correct1">Correct</label>
                            </div>
                            <div class="option-input">
                                <input type="radio" name="correctAnswer" value="2" id="correct2">
                                <input type="text" id="option2" placeholder="Option C">
                                <label for="correct2">Correct</label>
                            </div>
                            <div class="option-input">
                                <input type="radio" name="correctAnswer" value="3" id="correct3">
                                <input type="text" id="option3" placeholder="Option D">
                                <label for="correct3">Correct</label>
                            </div>
                        </div>
                        <div style="display: flex; gap: 10px;">
                            <button class="btn btn-primary" onclick="saveQuestion()">Save Question</button>
                            <button class="btn btn-secondary" onclick="cancelEdit()" id="cancelBtn" style="display: none;">Cancel</button>
                        </div>
                        <div id="questionFormMessage"></div>
                    </div>

                    <div class="questions-list">
                        <div class="table-header">Question Bank</div>
                        <div id="questionsList">
                            <!-- Questions will be populated here -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Warning Overlay -->
    <div class="warning-overlay" id="warningOverlay">
        <div class="warning-modal">
            <div class="warning-title">⚠️ Security Violation Detected</div>
            <div class="warning-text" id="warningText">Suspicious activity detected. Please return to the quiz.</div>
            <button class="btn btn-primary" onclick="dismissWarning()">Continue Quiz</button>
        </div>
    </div>

    <script src="script.js"></script>
</body>
</html>
